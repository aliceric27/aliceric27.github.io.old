---
title: < script >的 async 與 defer 有什麼不同
date: 2024-09-04 14:43:04
tags:
  - [Front-end]
categories:
  - [Front-end]
---


「HTML 的 `<script>`當中，`async`與`defer`有什麼差別？」

<!-- more -->



HTML 在生成 DOM 時由上到下進行解析並生成，當遇到`<script>`標籤時，則會暫停載入 DOM 的生成，開始執行`<script>`腳本，執行完畢後才會繼續生成 DOM 。

`async`和`defer`則是更靈活的載入`<script>`方法，可以告訴瀏覽器，這兩個屬性都是在跟瀏覽器說，不用等腳本的載入，繼續建構 DOM。這讓 DOM 的建構與腳本的載入能夠同步進行，讓使用者體驗可以更好。

使用方式

```js
<script src="scriptA.js" defer></script>
<script src="scriptB.js" async></script>
```

------

### defer
`defer`會告訴瀏覽器，不用等腳本的下載與執行，可以繼續完成 HTML 的解析與 DOM 的建構；在建構 DOM 的同時，會在背景中載入腳本，因此`defer`不會擋住畫面的渲染。如果腳本在 HTML 解析完成前就下載好，會等到 HTML 都完全解析後，才會執行。因此如果有腳本是需要等 HTML 解析完、DOM 完整建立後才能載入，那麼會需要選`defer`。

如果同時有多個帶有`defer`屬性的`<script>`資源，瀏覽器會同步下載，只是會依照在 HTML 中的順序執行，這可以確保執行時是依照我們想要的順序。有些時候，可能某個腳本會依賴另一個腳本，例如 A 依賴 B，這時候要確保 A 是在 B 之前執行，這時會選擇用`defer`。

背景下載與執行順序：`defer`屬性的腳本會在 HTML 解析的同時被下載，但執行時機是在 DOM 完全構建完畢之後，並且所有`defer`腳本會按照它們在 HTML 中出現的順序執行。這個執行順序是有保證的。

適用情況：`defer`適用於依賴 DOM 的腳本，因為它們會在 DOM 加載完畢後才執行。此外，當有多個腳本之間有執行順序依賴時，也應使用`defer`。

### async
`async` 的意思是 asynchrnous，意即非同步，換句話說解析 HTML 與載入腳本，是非同步進行。因此，同樣會告訴瀏覽器，在解析 HTML 時不用等 `<script>` 腳本的下載與執行。但跟 `defer` 不同的地方在於， `async` 的腳本載入與 HTML 解析是彼此獨立的，因此只要下載完就會馬上執行，而不是像 `defer` 會等到 HTML 解析完成才執行。

除了跟 DOM 的建構是彼此獨立之外，帶有 `async` 屬性的腳本跟其他的腳本也是彼此獨立，哪個先下載完成就先執行。雖然在下載時不會暫停 HMTL 的解析，但在執行時腳本時會暫停解析。通常如果腳本載入跟 DOM、其他腳本是沒有相互依賴關係，例如 Google Analytics 這類分析用的腳本。

下載與執行的獨立性：`async`屬性的腳本會在下載完成後立即執行，無論此時 HTML 的解析進度如何。這意味著`async`腳本可能會在 DOM 尚未完全構建完畢時執行，因此它們不應依賴於 DOM 結構或其他腳本。

適用情況：`async`適合不依賴於 DOM 或其他腳本的情境，例如執行統計分析、廣告載入等。

### 額外考量

阻塞行為：儘管`async`和`defer`都不會阻塞 HTML 的解析，但`async`屬性的腳本在執行時會暫停 HTML 的解析。因此，在大量`async`腳本並行加載的情況下，可能會對頁面加載速度產生影響。

兼容性與支援度：大多數現代瀏覽器都完全支援`async`和`defer`屬性，但在較老的瀏覽器中可能會有一些兼容性問題。因此，在使用這些屬性時，也需要考慮目標用戶的瀏覽器版本。
